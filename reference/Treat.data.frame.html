<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Operates a two-stage data treatment process, based on two data treatment functions, and a pass/fail
function which detects outliers. The method of data treatment can be either specified by the global_specs argument (which applies
the same specifications to all columns in x), or else (additionally) by the indiv_specs argument which allows different
methods to be applied for each column. See details. For a simpler function for data treatment, see the wrapper function qTreat()."><title>Treat a data frame for outliers — Treat.data.frame • COINr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Treat a data frame for outliers — Treat.data.frame"><meta property="og:description" content="Operates a two-stage data treatment process, based on two data treatment functions, and a pass/fail
function which detects outliers. The method of data treatment can be either specified by the global_specs argument (which applies
the same specifications to all columns in x), or else (additionally) by the indiv_specs argument which allows different
methods to be applied for each column. See details. For a simpler function for data treatment, see the wrapper function qTreat()."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">COINr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.12</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/overview.html">Overview</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/v1.html">v1.0 updates</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-guides">Guides</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-guides">
    <h6 class="dropdown-header" data-toc-skip>Construction</h6>
    <a class="dropdown-item" href="../articles/coins.html">Building coins</a>
    <a class="dropdown-item" href="../articles/imputation.html">Imputation of missing data</a>
    <a class="dropdown-item" href="../articles/denomination.html">Denomination</a>
    <a class="dropdown-item" href="../articles/screening.html">Unit screening</a>
    <a class="dropdown-item" href="../articles/treat.html">Outlier treatment</a>
    <a class="dropdown-item" href="../articles/normalise.html">Normalisation</a>
    <a class="dropdown-item" href="../articles/weights.html">Weighting</a>
    <a class="dropdown-item" href="../articles/aggregate.html">Aggregation</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Post-processing</h6>
    <a class="dropdown-item" href="../articles/visualisation.html">Visualisation</a>
    <a class="dropdown-item" href="../articles/analysis.html">Statistical analysis</a>
    <a class="dropdown-item" href="../articles/results.html">Presenting results</a>
    <a class="dropdown-item" href="../articles/adjustments.html">Adjustments and comparisons</a>
    <a class="dropdown-item" href="../articles/sensitivity.html">Sensitivity analysis</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Other</h6>
    <a class="dropdown-item" href="../articles/data_selection.html">Data selection</a>
    <a class="dropdown-item" href="../articles/other_functions.html">Other functions</a>
  </div>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bluefoxr/COINr/">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Treat a data frame for outliers</h1>
      <small class="dont-index">Source: <a href="https://github.com/bluefoxr/COINr/blob/HEAD/R/treat.R" class="external-link"><code>R/treat.R</code></a></small>
      <div class="d-none name"><code>Treat.data.frame.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Operates a two-stage data treatment process, based on two data treatment functions, and a pass/fail
function which detects outliers. The method of data treatment can be either specified by the <code>global_specs</code> argument (which applies
the same specifications to all columns in <code>x</code>), or else (additionally) by the <code>indiv_specs</code> argument which allows different
methods to be applied for each column. See details. For a simpler function for data treatment, see the wrapper function <code><a href="qTreat.html">qTreat()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for data.frame</span></span>
<span><span class="fu"><a href="Treat.html">Treat</a></span><span class="op">(</span><span class="va">x</span>, global_specs <span class="op">=</span> <span class="cn">NULL</span>, indiv_specs <span class="op">=</span> <span class="cn">NULL</span>, combine_treat <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>A data frame. Can have both numeric and non-numeric columns.</p></dd>


<dt>global_specs</dt>
<dd><p>A list specifying the treatment to apply to all columns. This will be applied to all columns, except any
that are specified in the <code>indiv_specs</code> argument. Alternatively, set to <code>"none"</code> to apply no treatment. See details.</p></dd>


<dt>indiv_specs</dt>
<dd><p>A list specifying any individual treatment to apply to specific columns, overriding <code>global_specs</code>
for those columns. See details.</p></dd>


<dt>combine_treat</dt>
<dd><p>By default, if <code>f1</code> fails to pass <code>f_pass</code>, then <code>f2</code> is applied to the original <code>x</code>,
rather than the treated output of <code>f1</code>. If <code>combine_treat = TRUE</code>, <code>f2</code> will instead be applied to the output
of <code>f1</code>, so the two treatments will be combined.</p></dd>


<dt>...</dt>
<dd><p>arguments passed to or from other methods.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A treated data frame of data</p>
    </div>
    <div class="section level2">
    <h2 id="global-specifications">Global specifications<a class="anchor" aria-label="anchor" href="#global-specifications"></a></h2>
    <p>If the same method of data treatment should be applied to all the columns, use the <code>global_specs</code> argument. This argument takes a structured
list which looks like this:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>global_specs <span class="ot">=</span> <span class="fu">list</span>(<span class="at">f1 =</span> .,</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>                    <span class="at">f1_para =</span> <span class="fu">list</span>(.),</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>                    <span class="at">f2 =</span> .,</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>                    <span class="at">f2_para =</span> <span class="fu">list</span>(.),</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>                    <span class="at">f_pass =</span> .,</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>                    <span class="at">f_pass_para =</span> <span class="fu">list</span>()</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>                    )</span></code></pre><p></p></div>
<p>The entries in this list correspond to arguments in <code><a href="Treat.numeric.html">Treat.numeric()</a></code>, and the meanings of each are also described in more detail here
below. In brief, <code>f1</code> is the name of a function to apply at the first round of data treatment, <code>f1_para</code> is a list of any additional
parameters to pass to <code>f1</code>, <code>f2</code> and <code>f2_para</code> are equivalently the function name and parameters of the second round of data treatment, and
<code>f_pass</code> and <code>f_pass_para</code> are the function and additional arguments to check for the existence of outliers.</p>
<p>The default values for <code>global_specs</code> are as follows:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>global_specs <span class="ot">=</span> <span class="fu">list</span>(<span class="at">f1 =</span> <span class="st">"winsorise"</span>,</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>                     <span class="at">f1_para =</span> <span class="fu">list</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>                                    <span class="at">winmax =</span> <span class="dv">5</span>,</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>                                    <span class="at">skew_thresh =</span> <span class="dv">2</span>,</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>                                    <span class="at">kurt_thresh =</span> <span class="fl">3.5</span>,</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>                                    <span class="at">force_win =</span> <span class="cn">FALSE</span>),</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>                     <span class="at">f2 =</span> <span class="st">"log_CT"</span>,</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>                     <span class="at">f2_para =</span> <span class="fu">list</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>                     <span class="at">f_pass =</span> <span class="st">"check_SkewKurt"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>                     <span class="at">f_pass_para =</span> <span class="fu">list</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>                                        <span class="at">skew_thresh =</span> <span class="dv">2</span>,</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>                                        <span class="at">kurt_thresh =</span> <span class="fl">3.5</span>))</span></code></pre><p></p></div>
<p>This shows that by default (i.e. if <code>global_specs</code> is not specified), each column is checked for outliers by the <code><a href="check_SkewKurt.html">check_SkewKurt()</a></code> function, which
uses skew and kurtosis thresholds as its parameters. Then, if outliers exist, the first function <code><a href="winsorise.html">winsorise()</a></code> is applied, which also
uses skew and kurtosis parameters, as well as a maximum number of winsorised points. If the Winsorisation function does not satisfy
<code>f_pass</code>, the <code><a href="log_CT.html">log_CT()</a></code> function is invoked.</p>
<p>To change the global specifications, you don't have to supply the whole list. If, for example, you are happy with all the defaults but
want to simply change the maximum number of Winsorised points, you could specify e.g. <code>global_specs = list(f1_para = list(winmax = 3))</code>.
In other words, a subset of the list can be specified, as long as the structure of the list is correct.</p>
    </div>
    <div class="section level2">
    <h2 id="individual-specifications">Individual specifications<a class="anchor" aria-label="anchor" href="#individual-specifications"></a></h2>
    <p>The <code>indiv_specs</code> argument allows different specifications for each column in <code>x</code>. This is done by wrapping multiple lists of the format of the
list described in <code>global_specs</code> into one single list, named according to the column names of <code>x</code>. For example, if <code>x</code> has column names
"x1", "x2" and "x3", we could specify individual treatment as follows:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>indiv_specs <span class="ot">=</span> <span class="fu">list</span>(<span class="at">x1 =</span> <span class="fu">list</span>(.),</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>                   <span class="at">x2 =</span> <span class="fu">list</span>(.)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>                   <span class="at">x3 =</span> <span class="fu">list</span>(.))</span></code></pre><p></p></div>
<p>where each <code>list(.)</code> is a specifications list of the same format as <code>global_specs</code>. Any columns that are not named in <code>indiv_specs</code> are
treated using the specifications from <code>global_specs</code> (which will be the defaults if it is not specified). As with <code>global_specs</code>,
a subset of the <code>global_specs</code> list may be specified for
each entry. Additionally, as a special case, specifying a list entry as e.g. <code>x1 = "none"</code> will apply no data treatment to the column "x1". See
<code><a href="../articles/treat.html">vignette("treat")</a></code> for examples of individual treatment.</p>
    </div>
    <div class="section level2">
    <h2 id="function-methodology">Function methodology<a class="anchor" aria-label="anchor" href="#function-methodology"></a></h2>
    <p>This function is set up to allow any functions to be passed as the
data treatment functions (<code>f1</code> and <code>f2</code>), as well as any function to be passed as the outlier detection
function <code>f_pass</code>, as specified in the <code>global_specs</code> and <code>indiv_specs</code> arguments.</p>
<p>The arrangement of this function is inspired by a fairly standard data treatment process applied to
indicators, which consists of checking skew and kurtosis, then if the criteria are not met, applying
Winsorisation up to a specified limit. Then if Winsorisation still does not bring skew and kurtosis
within limits, applying a nonlinear transformation such as log or Box-Cox.</p>
<p>This function generalises this process by using the following general steps:</p><ol><li><p>Check if variable passes or fails using <code>f_pass</code></p></li>
<li><p>If <code>f_pass</code> returns <code>FALSE</code>, apply <code>f1</code>, else return <code>x</code> unmodified</p></li>
<li><p>Check again using *<code>f_pass</code></p></li>
<li><p>If <code>f_pass</code> still returns <code>FALSE</code>, apply <code>f2</code></p></li>
<li><p>Return the modified <code>x</code> as well as other information.</p></li>
</ol><p>For the "typical" case described above <code>f1</code> is a Winsorisation function, <code>f2</code> is a nonlinear transformation
and <code>f_pass</code> is a skew and kurtosis check. Parameters can be passed to each of these three functions in
a named list, for example to specify a maximum number of points to Winsorise, or Box-Cox parameters, or anything
else. The constraints are that:</p><ul><li><p>All of <code>f1</code>, <code>f2</code> and <code>f_pass</code> must follow the format <code>function(x, f_para)</code>, where <code>x</code> is a
numerical vector, and <code>f_para</code> is a list of other function parameters to be passed to the function, which
is specified by <code>f1_para</code> for <code>f1</code> and similarly for the other functions. If the function has no parameters
other than <code>x</code>, then <code>f_para</code> can be omitted.</p></li>
<li><p><code>f1</code> and <code>f2</code> should return either a list with <code>.$x</code> as the modified numerical vector, and any other information
to be attached to the list, OR, simply <code>x</code> as the only output.</p></li>
<li><p><code>f_pass</code> must return a logical value, where <code>TRUE</code> indicates that the <code>x</code> passes the criteria (and
therefore doesn't need any (more) treatment), and <code>FALSE</code> means that it fails to meet the criteria.</p></li>
</ul><p>See also <code><a href="../articles/treat.html">vignette("treat")</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># select three indicators</span></span></span>
<span class="r-in"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="va">ASEM_iData</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Flights"</span>, <span class="st">"Goods"</span>, <span class="st">"Services"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># treat the data frame using defaults</span></span></span>
<span class="r-in"><span><span class="va">l_treat</span> <span class="op">&lt;-</span> <span class="fu"><a href="Treat.html">Treat</a></span><span class="op">(</span><span class="va">df1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># details of data treatment for each column</span></span></span>
<span class="r-in"><span><span class="va">l_treat</span><span class="op">$</span><span class="va">Dets_Table</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      iCode check_SkewKurt0.Pass check_SkewKurt0.Skew check_SkewKurt0.Kurt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  Flights                FALSE             2.103287             4.508879</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2    Goods                FALSE             2.649973             8.266610</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Services                 TRUE             1.701085             2.375656</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   winsorise.nwin check_SkewKurt1.Pass check_SkewKurt1.Skew check_SkewKurt1.Kurt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1              1                 TRUE             1.900658            3.3360647</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2              2                 TRUE             1.140608            0.1572047</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3             NA                   NA                   NA                   NA</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="http://www.willbecker.me" class="external-link">William Becker</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

