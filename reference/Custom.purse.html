<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Custom operation — Custom.purse • COINr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Custom operation — Custom.purse"><meta name="description" content="Custom operation on a purse. This is an experimental new feature."><meta property="og:description" content="Custom operation on a purse. This is an experimental new feature."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">COINr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.14</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/overview.html">Overview</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/v1.html">v1.0 updates</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-guides"><li><h6 class="dropdown-header" data-toc-skip>Construction</h6></li>
    <li><a class="dropdown-item" href="../articles/coins.html">Building coins</a></li>
    <li><a class="dropdown-item" href="../articles/imputation.html">Imputation of missing data</a></li>
    <li><a class="dropdown-item" href="../articles/denomination.html">Denomination</a></li>
    <li><a class="dropdown-item" href="../articles/screening.html">Unit screening</a></li>
    <li><a class="dropdown-item" href="../articles/treat.html">Outlier treatment</a></li>
    <li><a class="dropdown-item" href="../articles/normalise.html">Normalisation</a></li>
    <li><a class="dropdown-item" href="../articles/weights.html">Weighting</a></li>
    <li><a class="dropdown-item" href="../articles/aggregate.html">Aggregation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Post-processing</h6></li>
    <li><a class="dropdown-item" href="../articles/visualisation.html">Visualisation</a></li>
    <li><a class="dropdown-item" href="../articles/analysis.html">Statistical analysis</a></li>
    <li><a class="dropdown-item" href="../articles/results.html">Presenting results</a></li>
    <li><a class="dropdown-item" href="../articles/adjustments.html">Adjustments and comparisons</a></li>
    <li><a class="dropdown-item" href="../articles/sensitivity.html">Sensitivity analysis</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other</h6></li>
    <li><a class="dropdown-item" href="../articles/data_selection.html">Data selection</a></li>
    <li><a class="dropdown-item" href="../articles/other_functions.html">Other functions</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/bluefoxr/COINr/"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Custom operation</h1>
      <small class="dont-index">Source: <a href="https://github.com/bluefoxr/COINr/blob/master/R/custom.R" class="external-link"><code>R/custom.R</code></a></small>
      <div class="d-none name"><code>Custom.purse.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Custom operation on a purse. This is an experimental new feature.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'purse'</span></span>
<span><span class="fu"><a href="Custom.html">Custom</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">dset</span>,</span>
<span>  <span class="va">f_cust</span>,</span>
<span>  f_cust_para <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  global <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  write_to <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A purse object</p></dd>


<dt id="arg-dset">dset<a class="anchor" aria-label="anchor" href="#arg-dset"></a></dt>
<dd><p>The data set to apply the operation to.</p></dd>


<dt id="arg-f-cust">f_cust<a class="anchor" aria-label="anchor" href="#arg-f-cust"></a></dt>
<dd><p>Function to apply to the data set. See details.</p></dd>


<dt id="arg-f-cust-para">f_cust_para<a class="anchor" aria-label="anchor" href="#arg-f-cust-para"></a></dt>
<dd><p>Optional additional parameters to pass to the function defined
by <code>f_cust</code>.</p></dd>


<dt id="arg-global">global<a class="anchor" aria-label="anchor" href="#arg-global"></a></dt>
<dd><p>Logical: if <code>TRUE</code>, the entire data set, over all time points, is passed
to the function <code>f_cust</code>. This is useful if the custom operation should be different for
different time points, for example. Otherwise if <code>FALSE</code>, passes the data set within each
coin one at a time to <code>f_cust</code>.</p></dd>


<dt id="arg-write-to">write_to<a class="anchor" aria-label="anchor" href="#arg-write-to"></a></dt>
<dd><p>Name of data set to write to</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments to pass to/from other methods.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An updated purse.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>In this function, the data set named <code>dset</code> is extracted from the coin using
<code>get_dset(purse, dset)</code>. It is passed to the function <code>f_cust</code>, which is required
to return an equivalent but modified data frame, which is then written as a new
data set with name <code>write_to</code>. This is intended to allow arbitrary operations
on coin data sets while staying within the COINr framework, which means that if
<code><a href="Regen.html">Regen()</a></code> is used, these operations will be re-run, allowing them to be included
in things like sensitivity analysis.</p>
<p>The format of <code>f_cust</code> is important. It must be a function whose first argument
is called <code>x</code>: this will be the argument that the data is passed to. The data will
be in the same format as extracted via <code>get_dset(purse, dset)</code>, which means it will
have <code>uCode</code> and <code>Time</code> columns. <code>f_cust</code> can have other arguments which are passed
to it via <code>f_cust_para</code>. The function should return a data frame similar to the data
that was passed to it, it must contain have the same column names (meaning you can't
remove indicators), but otherwise is flexible - this means some caution is necessary
to ensure that subsequent operations don't fail. Be careful, for example, to ensure
that there are no duplicates in <code>uCode</code>, and that indicator columns are numeric.</p>
<p>The function assigned to <code>f_cust</code> is passed to <code><a href="https://rdrr.io/r/base/do.call.html" class="external-link">base::do.call()</a></code>, therefore it can
be passed either as a string naming the function, or as the function itself. Depending
on the context, the latter option may be preferable because this stores the function
within the coin, which makes it portable. Otherwise, if the function is simply
named as a string, you must make sure it is available to access in the environment.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># build example purse</span></span></span>
<span class="r-in"><span><span class="va">purse</span> <span class="op">&lt;-</span> <span class="fu"><a href="build_example_purse.html">build_example_purse</a></span><span class="op">(</span>up_to <span class="op">=</span> <span class="st">"new_coin"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iData checked and OK.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iMeta checked and OK.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Written data set to .$Data$Raw</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Written data set to .$Data$Raw</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Written data set to .$Data$Raw</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Written data set to .$Data$Raw</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Written data set to .$Data$Raw</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># custom function - set points before 2020 to NA for BEL in FDI due to a</span></span></span>
<span class="r-in"><span><span class="co"># break in the series</span></span></span>
<span class="r-in"><span><span class="va">f_cust</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">[</span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">uCode</span> <span class="op">==</span> <span class="st">"BEL"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;</span> <span class="fl">2020</span><span class="op">)</span>, <span class="st">"FDI"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>;</span></span>
<span class="r-in"><span>                      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="http://www.willbecker.me" class="external-link">William Becker</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

