<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Treat a numeric vector for outliers — Treat.numeric • COINr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Treat a numeric vector for outliers — Treat.numeric"><meta name="description" content="Operates a two-stage data treatment process, based on two data treatment functions, and a pass/fail
function which detects outliers. This function is set up to allow any functions to be passed as the
data treatment functions (f1 and f2), as well as any function to be passed as the outlier detection
function f_pass."><meta property="og:description" content="Operates a two-stage data treatment process, based on two data treatment functions, and a pass/fail
function which detects outliers. This function is set up to allow any functions to be passed as the
data treatment functions (f1 and f2), as well as any function to be passed as the outlier detection
function f_pass."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">COINr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.14</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/overview.html">Overview</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/v1.html">v1.0 updates</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-guides"><li><h6 class="dropdown-header" data-toc-skip>Construction</h6></li>
    <li><a class="dropdown-item" href="../articles/coins.html">Building coins</a></li>
    <li><a class="dropdown-item" href="../articles/imputation.html">Imputation of missing data</a></li>
    <li><a class="dropdown-item" href="../articles/denomination.html">Denomination</a></li>
    <li><a class="dropdown-item" href="../articles/screening.html">Unit screening</a></li>
    <li><a class="dropdown-item" href="../articles/treat.html">Outlier treatment</a></li>
    <li><a class="dropdown-item" href="../articles/normalise.html">Normalisation</a></li>
    <li><a class="dropdown-item" href="../articles/weights.html">Weighting</a></li>
    <li><a class="dropdown-item" href="../articles/aggregate.html">Aggregation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Post-processing</h6></li>
    <li><a class="dropdown-item" href="../articles/visualisation.html">Visualisation</a></li>
    <li><a class="dropdown-item" href="../articles/analysis.html">Statistical analysis</a></li>
    <li><a class="dropdown-item" href="../articles/results.html">Presenting results</a></li>
    <li><a class="dropdown-item" href="../articles/adjustments.html">Adjustments and comparisons</a></li>
    <li><a class="dropdown-item" href="../articles/sensitivity.html">Sensitivity analysis</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other</h6></li>
    <li><a class="dropdown-item" href="../articles/data_selection.html">Data selection</a></li>
    <li><a class="dropdown-item" href="../articles/other_functions.html">Other functions</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/bluefoxr/COINr/"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Treat a numeric vector for outliers</h1>
      <small class="dont-index">Source: <a href="https://github.com/bluefoxr/COINr/blob/master/R/treat.R" class="external-link"><code>R/treat.R</code></a></small>
      <div class="d-none name"><code>Treat.numeric.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Operates a two-stage data treatment process, based on two data treatment functions, and a pass/fail
function which detects outliers. This function is set up to allow any functions to be passed as the
data treatment functions (<code>f1</code> and <code>f2</code>), as well as any function to be passed as the outlier detection
function <code>f_pass</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'numeric'</span></span>
<span><span class="fu"><a href="Treat.html">Treat</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">f1</span>,</span>
<span>  f1_para <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  f2 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  f2_para <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">f_pass</span>,</span>
<span>  f_pass_para <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  combine_treat <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A numeric vector.</p></dd>


<dt id="arg-f-">f1<a class="anchor" aria-label="anchor" href="#arg-f-"></a></dt>
<dd><p>First stage data treatment function e.g. as a string.</p></dd>


<dt id="arg-f-para">f1_para<a class="anchor" aria-label="anchor" href="#arg-f-para"></a></dt>
<dd><p>First stage data treatment function parameters as a named list.</p></dd>


<dt id="arg-f-">f2<a class="anchor" aria-label="anchor" href="#arg-f-"></a></dt>
<dd><p>First stage data treatment function as a string.</p></dd>


<dt id="arg-f-para">f2_para<a class="anchor" aria-label="anchor" href="#arg-f-para"></a></dt>
<dd><p>First stage data treatment function parameters as a named list.</p></dd>


<dt id="arg-f-pass">f_pass<a class="anchor" aria-label="anchor" href="#arg-f-pass"></a></dt>
<dd><p>A string specifying an outlier detection function - see details. Default <code>"check_SkewKurt"</code></p></dd>


<dt id="arg-f-pass-para">f_pass_para<a class="anchor" aria-label="anchor" href="#arg-f-pass-para"></a></dt>
<dd><p>Any further arguments to pass to <code>f_pass()</code>, as a named list.</p></dd>


<dt id="arg-combine-treat">combine_treat<a class="anchor" aria-label="anchor" href="#arg-combine-treat"></a></dt>
<dd><p>By default, if <code>f1</code> fails to pass <code>f_pass</code>, then <code>f2</code> is applied to the original <code>x</code>,
rather than the treated output of <code>f1</code>. If <code>combine_treat = TRUE</code>, <code>f2</code> will instead be applied to the output
of <code>f1</code>, so the two treatments will be combined.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>arguments passed to or from other methods.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A treated vector of data.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The arrangement of this function is inspired by a fairly standard data treatment process applied to
indicators, which consists of checking skew and kurtosis, then if the criteria are not met, applying
Winsorisation up to a specified limit. Then if Winsorisation still does not bring skew and kurtosis
within limits, applying a nonlinear transformation such as log or Box-Cox.</p>
<p>This function generalises this process by using the following general steps:</p><ol><li><p>Check if variable passes or fails using <code>f_pass</code></p></li>
<li><p>If <code>f_pass</code> returns <code>FALSE</code>, apply <code>f1</code>, else return <code>x</code> unmodified</p></li>
<li><p>Check again using *<code>f_pass</code></p></li>
<li><p>If <code>f_pass</code> still returns <code>FALSE</code>, apply <code>f2</code> (by default to the original <code>x</code>, see <code>combine_treat</code>
parameter)</p></li>
<li><p>Return the modified <code>x</code> as well as other information.</p></li>
</ol><p>For the "typical" case described above <code>f1</code> is a Winsorisation function, <code>f2</code> is a nonlinear transformation
and <code>f_pass</code> is a skew and kurtosis check. Parameters can be passed to each of these three functions in
a named list, for example to specify a maximum number of points to Winsorise, or Box-Cox parameters, or anything
else. The constraints are that:</p><ul><li><p>All of <code>f1</code>, <code>f2</code> and <code>f_pass</code> must follow the format <code>function(x, f_para)</code>, where <code>x</code> is a
numerical vector, and <code>f_para</code> is a list of other function parameters to be passed to the function, which
is specified by <code>f1_para</code> for <code>f1</code> and similarly for the other functions. If the function has no parameters
other than <code>x</code>, then <code>f_para</code> can be omitted.</p></li>
<li><p><code>f1</code> and <code>f2</code> should return either a list with <code>.$x</code> as the modified numerical vector, and any other information
to be attached to the list, OR, simply <code>x</code> as the only output.</p></li>
<li><p><code>f_pass</code> must return a logical value, where <code>TRUE</code> indicates that the <code>x</code> passes the criteria (and
therefore doesn't need any (more) treatment), and <code>FALSE</code> means that it fails to meet the criteria.</p></li>
</ul><p>See also <code><a href="../articles/treat.html">vignette("treat")</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># numbers between 1 and 10</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># two outliers</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">30</span>, <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># check whether passes skew/kurt test</span></span></span>
<span class="r-in"><span><span class="fu"><a href="check_SkewKurt.html">check_SkewKurt</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Pass</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Skew</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3.063241</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Kurt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 9.741391</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># treat using winsorisation</span></span></span>
<span class="r-in"><span><span class="va">l_treat</span> <span class="op">&lt;-</span> <span class="fu"><a href="Treat.html">Treat</a></span><span class="op">(</span><span class="va">x</span>, f1 <span class="op">=</span> <span class="st">"winsorise"</span>, f1_para <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>winmax <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 f_pass <span class="op">=</span> <span class="st">"check_SkewKurt"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot original against treated</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">l_treat</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="Treat.numeric-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="http://www.willbecker.me" class="external-link">William Becker</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

