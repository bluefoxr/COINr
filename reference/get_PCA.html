<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Performs Principle Component Analysis (PCA) on a specified data set and subset of indicators or aggregation groups.
This function has two main outputs: the output(s) of stats::prcomp(), and optionally the weights resulting from
the PCA. Therefore it can be used as an analysis tool and/or a weighting tool. For the weighting aspect, please
see the details below."><title>Perform PCA on a coin — get_PCA • COINr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Perform PCA on a coin — get_PCA"><meta property="og:description" content="Performs Principle Component Analysis (PCA) on a specified data set and subset of indicators or aggregation groups.
This function has two main outputs: the output(s) of stats::prcomp(), and optionally the weights resulting from
the PCA. Therefore it can be used as an analysis tool and/or a weighting tool. For the weighting aspect, please
see the details below."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">COINr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.13</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/overview.html">Overview</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/v1.html">v1.0 updates</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-guides">Guides</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-guides">
    <h6 class="dropdown-header" data-toc-skip>Construction</h6>
    <a class="dropdown-item" href="../articles/coins.html">Building coins</a>
    <a class="dropdown-item" href="../articles/imputation.html">Imputation of missing data</a>
    <a class="dropdown-item" href="../articles/denomination.html">Denomination</a>
    <a class="dropdown-item" href="../articles/screening.html">Unit screening</a>
    <a class="dropdown-item" href="../articles/treat.html">Outlier treatment</a>
    <a class="dropdown-item" href="../articles/normalise.html">Normalisation</a>
    <a class="dropdown-item" href="../articles/weights.html">Weighting</a>
    <a class="dropdown-item" href="../articles/aggregate.html">Aggregation</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Post-processing</h6>
    <a class="dropdown-item" href="../articles/visualisation.html">Visualisation</a>
    <a class="dropdown-item" href="../articles/analysis.html">Statistical analysis</a>
    <a class="dropdown-item" href="../articles/results.html">Presenting results</a>
    <a class="dropdown-item" href="../articles/adjustments.html">Adjustments and comparisons</a>
    <a class="dropdown-item" href="../articles/sensitivity.html">Sensitivity analysis</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Other</h6>
    <a class="dropdown-item" href="../articles/data_selection.html">Data selection</a>
    <a class="dropdown-item" href="../articles/other_functions.html">Other functions</a>
  </div>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bluefoxr/COINr/">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Perform PCA on a coin</h1>
      <small class="dont-index">Source: <a href="https://github.com/bluefoxr/COINr/blob/HEAD/R/PCA.R" class="external-link"><code>R/PCA.R</code></a></small>
      <div class="d-none name"><code>get_PCA.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Performs Principle Component Analysis (PCA) on a specified data set and subset of indicators or aggregation groups.
This function has two main outputs: the output(s) of <code><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">stats::prcomp()</a></code>, and optionally the weights resulting from
the PCA. Therefore it can be used as an analysis tool and/or a weighting tool. For the weighting aspect, please
see the details below.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">get_PCA</span><span class="op">(</span></span>
<span>  <span class="va">coin</span>,</span>
<span>  dset <span class="op">=</span> <span class="st">"Raw"</span>,</span>
<span>  iCodes <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Level <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  by_groups <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  nowarnings <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  weights_to <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  out2 <span class="op">=</span> <span class="st">"list"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>coin</dt>
<dd><p>A coin</p></dd>


<dt>dset</dt>
<dd><p>The name of the data set in <code>.$Data</code> to use.</p></dd>


<dt>iCodes</dt>
<dd><p>An optional character vector of indicator codes to subset the indicator data, passed to <code><a href="get_data.html">get_data()</a></code></p></dd>


<dt>Level</dt>
<dd><p>The aggregation level to take indicator data from. Integer from 1 (indicator level)
to N (top aggregation level, typically the index).</p></dd>


<dt>by_groups</dt>
<dd><p>If <code>TRUE</code> (default), performs PCA inside each aggregation group inside the specified level. If <code>FALSE</code>,
performs a single PCA over all indicators/aggregates in the specified level.</p></dd>


<dt>nowarnings</dt>
<dd><p>If <code>FALSE</code> (default), will give warnings where missing data are found. Set to <code>TRUE</code> to suppress these warnings.</p></dd>


<dt>weights_to</dt>
<dd><p>A string to name the resulting set of weights. If this is specified, and <code>out2 = "coin"</code>,
will write a new set of "PCA weights" to the <code>.$Meta$Weights</code> list. This is experimental - see details. If
<code>NULL</code>, does not write any weights (default).</p></dd>


<dt>out2</dt>
<dd><p>If the input is a coin object, this controls where to send the output. If <code>"coin"</code>, it
sends the results to the coin object, otherwise if <code>"list"</code>, outputs to a separate list (default).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>If <code>out2 = "coin"</code>, results are appended to the coin object. Specifically:</p><ul><li><p>A list is added to <code>.$Analysis</code> containing PCA weights (loadings) of the first principle component, and the output of <a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">stats::prcomp</a>, for each
aggregation group found in the targeted level.</p></li>
<li><p>If <code>weights_to</code> is specified, a new set of PCA weights is added to <code>.$Meta$Weights</code>
If <code>out2 = "list"</code> the same outputs are contained in a list.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>PCA must be approached with care and an understanding of what is going on. First, let's consider the PCA excluding
the weighting component. PCA takes a set of data consisting of variables (indicators) and observations. It then
rotates the coordinate system such that in the new coordinate system, the first axis (called the first principal
component (PC)) aligns with the direction of maximum variance of the data set. The amount of variance explained by the
first PC, and by the next several PCs, can help to understand whether the data can be explained by simpler set of
variables. PCA is often used for dimensionality reduction in modelling, for example.</p>
<p>In the context of composite indicators, PCA can be used first as an analysis tool. We can check for example, within
an aggregation group, can the indicators mostly be explained by one PC? If so, this gives a little extra justification
to aggregating the indicators because the information lost in aggregation will be less. We can also check this over
the entire set of indicators.</p>
<p>The complications are in a composite indicator, the indicators are grouped and arranged into a hierarchy. This means
that when performing a PCA, we have to decide which level to perform it at, and which groupings to use, if any. The <code>get_PCA()</code>
function, using the <code>by_groups</code> argument, allows to automatically apply PCA by group if this is required.</p>
<p>The output of <code>get_PCA()</code> is a PCA object for each of the groups specified, which can then be examined using existing
tools in R, see <code><a href="../articles/analysis.html">vignette("analysis")</a></code>.</p>
<p>The other output of <code>get_PCA()</code> is a set of "PCA weights" if the <code>weights_to</code> argument is specified. Here we also need
to say some words of caution. First, what constitutes "PCA weights" in composite indicators is not very well-defined.
In COINr, a simple option is adopted. That is, the loadings of the first principal component are taken as the weights.
The logic here is that these loadings should maximise the explained variance - the implication being that if we use
these as weights in an aggregation, we should maximise the explained variance and hence the information passed from
the indicators to the aggregate value. This is a nice property in a composite indicator, where one of the aims is to
represent many indicators by single composite. See <a href="https://doi.org/10.1016/j.envsoft.2021.105208" class="external-link">doi:10.1016/j.envsoft.2021.105208</a>
 for a
discussion on this.</p>
<p>But. The weights that result from PCA have a number of downsides. First, they can often include negative weights
which can be hard to justify. Also PCA may arbitrarily flip the axes (since from a variance point of view the
direction is not important). In the quest for maximum variance, PCA will also weight the strongest-correlating
indicators the highest, which means that other indicators may be neglected. In short, it often results in a very
unbalanced set of weights. Moreover, PCA can only be performed on one level at a time.</p>
<p>All these considerations point to the fact: while PCA as an analysis tool is well-established, please use PCA weights
with care and understanding of what is going on.</p>
<p>This function replaces the now-defunct <code>getPCA()</code> from COINr &lt; v1.0.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index">
<ul><li><p><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">stats::prcomp</a> Principle component analysis</p></li>
</ul></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># build example coin</span></span></span>
<span class="r-in"><span><span class="va">coin</span> <span class="op">&lt;-</span> <span class="fu"><a href="build_example_coin.html">build_example_coin</a></span><span class="op">(</span>up_to <span class="op">=</span> <span class="st">"new_coin"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># PCA on "Sust" group of indicators</span></span></span>
<span class="r-in"><span><span class="va">l_pca</span> <span class="op">&lt;-</span> <span class="fu">get_PCA</span><span class="op">(</span><span class="va">coin</span>, dset <span class="op">=</span> <span class="st">"Raw"</span>, iCodes <span class="op">=</span> <span class="st">"Sust"</span>,</span></span>
<span class="r-in"><span>                 out2 <span class="op">=</span> <span class="st">"list"</span>, nowarnings <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Summary of results for one of the sub-groups</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">l_pca</span><span class="op">$</span><span class="va">PCAresults</span><span class="op">$</span><span class="va">Social</span><span class="op">$</span><span class="va">PCAres</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Importance of components:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                           PC1    PC2    PC3     PC4     PC5     PC6     PC7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard deviation     2.2042 1.1256 0.9788 0.78834 0.77153 0.56836 0.42463</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Proportion of Variance 0.5398 0.1408 0.1065 0.06905 0.06614 0.03589 0.02003</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cumulative Proportion  0.5398 0.6806 0.7871 0.85611 0.92225 0.95814 0.97817</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                            PC8     PC9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard deviation     0.36068 0.25760</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Proportion of Variance 0.01445 0.00737</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cumulative Proportion  0.99263 1.00000</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="http://www.willbecker.me" class="external-link">William Becker</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

