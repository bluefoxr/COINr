<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="COINr">
<title>Weights • COINr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Weights">
<meta property="og:description" content="COINr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">COINr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.3.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/overview.html">Overview</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/v1.html">v1.0 updates</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-guides">Guides</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-guides">
    <h6 class="dropdown-header" data-toc-skip>Construction</h6>
    <a class="dropdown-item" href="../articles/coins.html">Building coins</a>
    <a class="dropdown-item" href="../articles/imputation.html">Imputation of missing data</a>
    <a class="dropdown-item" href="../articles/denomination.html">Denomination</a>
    <a class="dropdown-item" href="../articles/screening.html">Unit screening</a>
    <a class="dropdown-item" href="../articles/treat.html">Outlier treatment</a>
    <a class="dropdown-item" href="../articles/normalise.html">Normalisation</a>
    <a class="dropdown-item" href="../articles/weights.html">Weighting</a>
    <a class="dropdown-item" href="../articles/aggregate.html">Aggregation</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Post-processing</h6>
    <a class="dropdown-item" href="../articles/visualisation.html">Visualisation</a>
    <a class="dropdown-item" href="../articles/analysis.html">Statistical analysis</a>
    <a class="dropdown-item" href="../articles/results.html">Presenting results</a>
    <a class="dropdown-item" href="../articles/adjustments.html">Adjustments and comparisons</a>
    <a class="dropdown-item" href="../articles/sensitivity.html">Sensitivity analysis</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Other</h6>
    <a class="dropdown-item" href="../articles/data_selection.html">Data selection</a>
    <a class="dropdown-item" href="../articles/other_functions.html">Other functions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bluefoxr/COINr/">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Weights</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bluefoxr/COINr/blob/HEAD/vignettes/weights.Rmd" class="external-link"><code>vignettes/weights.Rmd</code></a></small>
      <div class="d-none name"><code>weights.Rmd</code></div>
    </div>

    
    
<p>Weights are used by most aggregation methods to optionally alter the
contribution of each indicator in an aggregation group, as well as by
aggregates themselves if they are further aggregated. Weighting is
therefore part of aggregation, but this vignette deals with it
separately because there are a few special tools for weighting in
COINr.</p>
<p>First, let’s see what weights look like in practice. When a coin is
built using <code><a href="../reference/new_coin.html">new_coin()</a></code>, the <code>iMeta</code> data frame
(an input to <code><a href="../reference/new_coin.html">new_coin()</a></code>) has a “Weight” column, which is
also required. Therefore, every coin should have a set of weights in it
by default, which you had to specify as part of its construction. Sets
of weights are stored in the <code>.$Meta$Weights</code> sub-list. Each
set of weights is stored as a data frame with a name. The set of weights
created when calling <code><a href="../reference/new_coin.html">new_coin()</a></code> is called “Original”. We
can see this by building the example coin and accessing the “Original”
set directly:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bluefoxr.github.io/COINr/">COINr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># build example coin</span></span>
<span><span class="va">coin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_example_coin.html">build_example_coin</a></span><span class="op">(</span>up_to <span class="op">=</span> <span class="st">"Normalise"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view weights</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">coin</span><span class="op">$</span><span class="va">Meta</span><span class="op">$</span><span class="va">Weights</span><span class="op">$</span><span class="va">Original</span><span class="op">)</span></span>
<span><span class="co">#&gt;       iCode Level Weight</span></span>
<span><span class="co">#&gt; 9     Goods     1      1</span></span>
<span><span class="co">#&gt; 10 Services     1      1</span></span>
<span><span class="co">#&gt; 11      FDI     1      1</span></span>
<span><span class="co">#&gt; 12   PRemit     1      1</span></span>
<span><span class="co">#&gt; 13  ForPort     1      1</span></span>
<span><span class="co">#&gt; 31    Renew     1      1</span></span></code></pre></div>
<p>The weight set simply has the indicator code, Level, and the weight
itself. Notice that the indicator codes also include aggregate codes, up
to the index:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># view rows not in level 1</span></span>
<span><span class="va">coin</span><span class="op">$</span><span class="va">Meta</span><span class="op">$</span><span class="va">Weights</span><span class="op">$</span><span class="va">Original</span><span class="op">[</span><span class="va">coin</span><span class="op">$</span><span class="va">Meta</span><span class="op">$</span><span class="va">Weights</span><span class="op">$</span><span class="va">Original</span><span class="op">$</span><span class="va">Level</span> <span class="op">!=</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;        iCode Level Weight</span></span>
<span><span class="co">#&gt; 50  Physical     2      1</span></span>
<span><span class="co">#&gt; 51  ConEcFin     2      1</span></span>
<span><span class="co">#&gt; 52 Political     2      1</span></span>
<span><span class="co">#&gt; 53    Instit     2      1</span></span>
<span><span class="co">#&gt; 54       P2P     2      1</span></span>
<span><span class="co">#&gt; 55   Environ     2      1</span></span>
<span><span class="co">#&gt; 56    Social     2      1</span></span>
<span><span class="co">#&gt; 57  SusEcFin     2      1</span></span>
<span><span class="co">#&gt; 58      Conn     3      1</span></span>
<span><span class="co">#&gt; 59      Sust     3      1</span></span>
<span><span class="co">#&gt; 60     Index     4      1</span></span></code></pre></div>
<p>And that the index itself doesn’t have a weight because it is not
used in an aggregation. Notice also that weights can be specified
<em>relative</em> to one another. When an aggregation group is
aggregated, the weights within that group are first scaled to sum to 1.
This means that weights are relative within groups, but not between
groups.</p>
<div class="section level2">
<h2 id="manual-re-weighting">Manual re-weighting<a class="anchor" aria-label="anchor" href="#manual-re-weighting"></a>
</h2>
<p>To change weights, one way is to simply go back to the original
<code>iMeta</code> data frame that you used to build the coin, and edit
it. If you don’t want to do that, you can also create a new weight set.
This simply involves:</p>
<ol style="list-style-type: decimal">
<li>Making a copy of the existing set of weights</li>
<li>Changing the weights of the copy</li>
<li>Putting the new set of weights in the coin</li>
</ol>
<p>For example, if we want to change the weighting of the “Conn” and
“Sust” sub-indices, we could do this:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># copy original weights</span></span>
<span><span class="va">w1</span> <span class="op">&lt;-</span> <span class="va">coin</span><span class="op">$</span><span class="va">Meta</span><span class="op">$</span><span class="va">Weights</span><span class="op">$</span><span class="va">Original</span></span>
<span></span>
<span><span class="co"># modify weights of Conn and Sust to 0.3 and 0.7 respectively</span></span>
<span><span class="va">w1</span><span class="op">$</span><span class="va">Weight</span><span class="op">[</span><span class="va">w1</span><span class="op">$</span><span class="va">iCode</span> <span class="op">==</span> <span class="st">"Conn"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.3</span></span>
<span><span class="va">w1</span><span class="op">$</span><span class="va">Weight</span><span class="op">[</span><span class="va">w1</span><span class="op">$</span><span class="va">iCode</span> <span class="op">==</span> <span class="st">"Sust"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.7</span></span>
<span></span>
<span><span class="co"># put weight set back with new name</span></span>
<span><span class="va">coin</span><span class="op">$</span><span class="va">Meta</span><span class="op">$</span><span class="va">Weights</span><span class="op">$</span><span class="va">MyFavouriteWeights</span> <span class="op">&lt;-</span> <span class="va">w1</span></span></code></pre></div>
<p>Now, to actually use these weights in aggregation, we have to direct
the <code><a href="../reference/Aggregate.html">Aggregate()</a></code> function to find them. When weights are
stored in the “Weights” sub-list as we have done here, this is easy
because we only have to pass the name of the weights to
<code><a href="../reference/Aggregate.html">Aggregate()</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Aggregate.html">Aggregate</a></span><span class="op">(</span><span class="va">coin</span>, dset <span class="op">=</span> <span class="st">"Normalised"</span>, w <span class="op">=</span> <span class="st">"MyFavouriteWeights"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Written data set to .$Data$Aggregated</span></span></code></pre></div>
<p>Alternatively, we can pass the data frame itself to
<code><a href="../reference/Aggregate.html">Aggregate()</a></code> if we don’t want to store it in the coin for
some reason:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Aggregate.html">Aggregate</a></span><span class="op">(</span><span class="va">coin</span>, dset <span class="op">=</span> <span class="st">"Normalised"</span>, w <span class="op">=</span> <span class="va">w1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Written data set to .$Data$Aggregated</span></span>
<span><span class="co">#&gt; (overwritten existing data set)</span></span></code></pre></div>
<p>When altering weights we may wish to compare the outcomes of
alternative sets of weights. See the <a href="adjustments.html">Adjustments and comparisons</a> vignette for
details on how to do this.</p>
</div>
<div class="section level2">
<h2 id="effective-weights">Effective weights<a class="anchor" aria-label="anchor" href="#effective-weights"></a>
</h2>
<p>COINr has some statistical tools for adjusting weights as explained
in the next sections. Before that, it is also interesting to look at
“effective weights”. At the index level, the weighting of an indicator
is not due just to its own weight, but also to the weights of each
aggregation that it is involved in, plus the number of
indicators/aggregates in each group. This means that the final
weighting, at the index level, of each indicator, is slightly complex to
understand. COINr has a built in function to get these “effective
weights”:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w_eff</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_eff_weights.html">get_eff_weights</a></span><span class="op">(</span><span class="va">coin</span>, out2 <span class="op">=</span> <span class="st">"df"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">w_eff</span><span class="op">)</span></span>
<span><span class="co">#&gt;       iCode Level Weight  EffWeight</span></span>
<span><span class="co">#&gt; 9     Goods     1      1 0.02000000</span></span>
<span><span class="co">#&gt; 10 Services     1      1 0.02000000</span></span>
<span><span class="co">#&gt; 11      FDI     1      1 0.02000000</span></span>
<span><span class="co">#&gt; 12   PRemit     1      1 0.02000000</span></span>
<span><span class="co">#&gt; 13  ForPort     1      1 0.02000000</span></span>
<span><span class="co">#&gt; 31    Renew     1      1 0.03333333</span></span></code></pre></div>
<p>The “EffWeight” column is the effective weight of each component at
the highest level of aggregation (the index). These weights sum to 1 for
each level:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get sum of effective weights for each level</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">w_eff</span><span class="op">$</span><span class="va">EffWeight</span>, <span class="va">w_eff</span><span class="op">$</span><span class="va">Level</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1 2 3 4 </span></span>
<span><span class="co">#&gt; 1 1 1 1</span></span></code></pre></div>
<p>The effective weights can also be viewed using the
<code><a href="../reference/plot_framework.html">plot_framework()</a></code> function, where the angle of each
indicator/aggregate is proportional to its effective weight:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_framework.html">plot_framework</a></span><span class="op">(</span><span class="va">coin</span><span class="op">)</span></span></code></pre></div>
<p><img src="weights_files/figure-html/unnamed-chunk-9-1.png" width="480"></p>
</div>
<div class="section level2">
<h2 id="pca-weights">PCA weights<a class="anchor" aria-label="anchor" href="#pca-weights"></a>
</h2>
<p>The <code><a href="../reference/get_PCA.html">get_PCA()</a></code> function can be used to return a set of
weights which maximises the explained variance within aggregation
groups. This function is already discussed in the <a href="analysis.html">Analysis</a> vignette, so we will only focus on the
weighting aspect here.</p>
<p>First of all, PCA weights come with a number of caveats which need to
be mentioned (this is also detailed in the <code><a href="../reference/get_PCA.html">get_PCA()</a></code>
function help). First, what constitutes “PCA weights” in composite
indicators is not very well-defined. In COINr, a simple option is
adopted. That is, the loadings of the first principal component are
taken as the weights. The logic here is that these loadings should
maximise the explained variance - the implication being that if we use
these as weights in an aggregation, we should maximise the explained
variance and hence the information passed from the indicators to the
aggregate value. This is a nice property in a composite indicator, where
one of the aims is to represent many indicators by single composite. See
<a href="https://doi.org/10.1016/j.envsoft.2021.105208" class="external-link">here</a> for a
discussion on this.</p>
<p>But. The weights that result from PCA have a number of downsides.
First, they can often include negative weights which can be hard to
justify. Also PCA may arbitrarily flip the axes (since from a variance
point of view the direction is not important). In the quest for maximum
variance, PCA will also weight the strongest-correlating indicators the
highest, which means that other indicators may be neglected. In short,
it often results in a very unbalanced set of weights. Moreover, PCA can
only be performed on one level at a time.</p>
<p>The result is that PCA weights should be used carefully. All that
said, let’s see how to get PCA weights. We simply run the
<code><a href="../reference/get_PCA.html">get_PCA()</a></code> function with <code>out2 = "coin"</code> and
specifying the name of the weights to use. Here, we will calculate PCA
weights at level 2, i.e. at the first level of aggregation. To do this,
we need to use the “Aggregated” data set because the PCA needs to have
the level 2 scores to work with:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_PCA.html">get_PCA</a></span><span class="op">(</span><span class="va">coin</span>, dset <span class="op">=</span> <span class="st">"Aggregated"</span>, Level <span class="op">=</span>  <span class="fl">2</span>,</span>
<span>                weights_to <span class="op">=</span> <span class="st">"PCAwtsLev2"</span>, out2 <span class="op">=</span> <span class="st">"coin"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Weights written to .$Meta$Weights$PCAwtsLev2</span></span></code></pre></div>
<p>This stores the new set of weights in the Weights sub-list, with the
name we gave it. Let’s have a look at the resulting weights. The only
weights that have changed are at level 2, so we look at those:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coin</span><span class="op">$</span><span class="va">Meta</span><span class="op">$</span><span class="va">Weights</span><span class="op">$</span><span class="va">PCAwtsLev2</span><span class="op">[</span><span class="va">coin</span><span class="op">$</span><span class="va">Meta</span><span class="op">$</span><span class="va">Weights</span><span class="op">$</span><span class="va">PCAwtsLev2</span><span class="op">$</span><span class="va">Level</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;        iCode Level     Weight</span></span>
<span><span class="co">#&gt; 50  Physical     2  0.5117970</span></span>
<span><span class="co">#&gt; 51  ConEcFin     2  0.3049926</span></span>
<span><span class="co">#&gt; 52 Political     2  0.3547671</span></span>
<span><span class="co">#&gt; 53    Instit     2  0.5081540</span></span>
<span><span class="co">#&gt; 54       P2P     2  0.5108455</span></span>
<span><span class="co">#&gt; 55   Environ     2  0.6513188</span></span>
<span><span class="co">#&gt; 56    Social     2 -0.7443677</span></span>
<span><span class="co">#&gt; 57  SusEcFin     2  0.1473108</span></span></code></pre></div>
<p>This shows the nature of PCA weights: actually in this case it is not
too severe but the Social dimension is negatively weighted because it is
negatively correlated with the other components in its group. In any
case, the weights can sometimes be “strange” to look at and that may or
may not be a problem. As explained above, to actually use these weights
we can call them when calling <code><a href="../reference/Aggregate.html">Aggregate()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="optimised-weights">Optimised weights<a class="anchor" aria-label="anchor" href="#optimised-weights"></a>
</h2>
<p>While PCA is based on linear algebra, another way to statistically
weight indicators is via numerical optimisation. Optimisation is a
numerical search method which finds a set of values which maximise or
minimise some criterion, called the “objective function”.</p>
<p>In composite indicators, different objectives are conceivable. The
<code><a href="../reference/get_opt_weights.html">get_opt_weights()</a></code> function gives two options in this
respect - either to look for the set of weights that “balances” the
indicators, or the set that maximises the information transferred (see
<a href="https://doi.org/10.1016/j.envsoft.2021.105208" class="external-link">here</a>). This
is done by looking at the correlations between indicators and the index.
This needs a little explanation.</p>
<p>If weights are chosen to match the opinions of experts, or indeed
your own opinion, there is a catch that is not very obvious. Put simply,
weights do not directly translate into importance.</p>
<p>To understand why, we must first define what “importance” means.
Actually there is more than one way to look at this, but one possible
measure is to use the (possibly nonlinear) correlation between each
indicator and the overall index. If the correlation is high, the
indicator is well-reflected in the index scores, and vice versa.</p>
<p>If we accept this definition of importance, then it’s important to
realise that this correlation is affected not only by the weights
attached to each indicator, but also by the correlations <em>between
indicators</em>. This means that these correlations must be accounted
for in choosing weights that agree with the budgets assigned by the
group of experts.</p>
<p>In fact, it is possible to reverse-engineer the weights either <a href="https://doi.org/10.1111/j.1467-985X.2012.01059.x" class="external-link">analytically
using a linear solution</a> or <a href="https://doi.org/10.1016/j.ecolind.2017.03.056" class="external-link">numerically using a
nonlinear solution</a>. While the former method is far quicker than a
nonlinear optimisation, it is only applicable in the case of a single
level of aggregation, with an arithmetic mean, and using linear
correlation as a measure. Therefore in COINr, the second method is
used.</p>
<p>Let’s now see how to use <code><a href="../reference/get_opt_weights.html">get_opt_weights()</a></code> in practice.
Like with PCA weights, we can only optimise one level at a time. We also
need to say what kind of optimisation to perform. Here, we will search
for the set of weights that results in equal influence of the
sub-indexes (level 3) on the index. We need a coin with an aggregated
data set already present, because the function needs to know which kind
of aggregation method you are using. Just before doing that, we will
first check what the correlations look like between level 3 and the
index, using equal weighting:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># build example coin</span></span>
<span><span class="va">coin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_example_coin.html">build_example_coin</a></span><span class="op">(</span>quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check correlations between level 3 and index</span></span>
<span><span class="fu"><a href="../reference/get_corr.html">get_corr</a></span><span class="op">(</span><span class="va">coin</span>, dset <span class="op">=</span> <span class="st">"Aggregated"</span>, Levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Var1 Var2 Correlation</span></span>
<span><span class="co">#&gt; 1 Index Conn   0.9397805</span></span>
<span><span class="co">#&gt; 2 Index Sust   0.8382873</span></span></code></pre></div>
<p>This shows that the correlations are similar but not the same. Now
let’s run the optimisation:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># optimise weights at level 3</span></span>
<span><span class="va">coin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_opt_weights.html">get_opt_weights</a></span><span class="op">(</span><span class="va">coin</span>, itarg <span class="op">=</span> <span class="st">"equal"</span>, dset <span class="op">=</span> <span class="st">"Aggregated"</span>,</span>
<span>                        Level <span class="op">=</span> <span class="fl">3</span>, weights_to <span class="op">=</span> <span class="st">"OptLev3"</span>, out2 <span class="op">=</span> <span class="st">"coin"</span><span class="op">)</span></span>
<span><span class="co">#&gt; iterating... objective function = -7.11287670895252</span></span>
<span><span class="co">#&gt; iterating... objective function = -6.75731482891423</span></span>
<span><span class="co">#&gt; iterating... objective function = -7.5563175412706</span></span>
<span><span class="co">#&gt; iterating... objective function = -8.21181051402935</span></span>
<span><span class="co">#&gt; iterating... objective function = -10.0802172796095</span></span>
<span><span class="co">#&gt; iterating... objective function = -13.3043247136273</span></span>
<span><span class="co">#&gt; iterating... objective function = -8.7011048855954</span></span>
<span><span class="co">#&gt; iterating... objective function = -7.93721550859392</span></span>
<span><span class="co">#&gt; iterating... objective function = -9.92111795779074</span></span>
<span><span class="co">#&gt; iterating... objective function = -8.57337082557942</span></span>
<span><span class="co">#&gt; iterating... objective function = -13.0490317878554</span></span>
<span><span class="co">#&gt; iterating... objective function = -10.1205749624737</span></span>
<span><span class="co">#&gt; iterating... objective function = -11.4698196057753</span></span>
<span><span class="co">#&gt; iterating... objective function = -11.5046209642509</span></span>
<span><span class="co">#&gt; iterating... objective function = -12.938292451273</span></span>
<span><span class="co">#&gt; Optimisation successful!</span></span>
<span><span class="co">#&gt; Optimised weights written to .$Meta$Weights$OptLev3</span></span></code></pre></div>
<p>We can view the optimised weights (weights will only change at level
3)</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coin</span><span class="op">$</span><span class="va">Meta</span><span class="op">$</span><span class="va">Weights</span><span class="op">$</span><span class="va">OptLev3</span><span class="op">[</span><span class="va">coin</span><span class="op">$</span><span class="va">Meta</span><span class="op">$</span><span class="va">Weights</span><span class="op">$</span><span class="va">OptLev3</span><span class="op">$</span><span class="va">Level</span> <span class="op">==</span> <span class="fl">3</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;    iCode Level    Weight</span></span>
<span><span class="co">#&gt; 58  Conn     3 0.3902439</span></span>
<span><span class="co">#&gt; 59  Sust     3 0.6097561</span></span></code></pre></div>
<p>To see if this was successful in balancing correlations, let’s
re-aggregate using these weights and check correlations.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># re-aggregate</span></span>
<span><span class="va">coin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Aggregate.html">Aggregate</a></span><span class="op">(</span><span class="va">coin</span>, dset <span class="op">=</span> <span class="st">"Normalised"</span>, w <span class="op">=</span> <span class="st">"OptLev3"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Written data set to .$Data$Aggregated</span></span>
<span><span class="co">#&gt; (overwritten existing data set)</span></span>
<span></span>
<span><span class="co"># check correlations between level 3 and index</span></span>
<span><span class="fu"><a href="../reference/get_corr.html">get_corr</a></span><span class="op">(</span><span class="va">coin</span>, dset <span class="op">=</span> <span class="st">"Aggregated"</span>, Levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Var1 Var2 Correlation</span></span>
<span><span class="co">#&gt; 1 Index Conn   0.8971336</span></span>
<span><span class="co">#&gt; 2 Index Sust   0.8925119</span></span></code></pre></div>
<p>This shows that indeed the correlations are now well-balanced - the
optimisation has worked.</p>
<p>We will not explore all the features of
<code><a href="../reference/get_opt_weights.html">get_opt_weights()</a></code> here, especially because optimisations
can take a significant amount of CPU time. However, the main options
include specifying a vector of “importances” rather than aiming for
equal importance, and optimising to maximise total correlation, rather
than balancing. There are also some numerical optimisation parameters
that could help if the optimisation doesn’t converge.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="http://www.willbecker.me" class="external-link">William Becker</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
